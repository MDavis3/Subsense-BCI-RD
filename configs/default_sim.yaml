# Subsense BCI Simulation Configuration
# =======================================
# This file contains tunable simulation parameters.
# Modify these values to experiment with different scenarios.
#
# Usage:
#   from subsense_bci.config import load_config
#   cfg = load_config()  # Loads this file, falls back to constants if missing

# -----------------------------------------------------------------------------
# Phase 1: Nanoparticle Cloud Parameters
# -----------------------------------------------------------------------------
cloud:
  # Cubic domain extent in mm (centered at origin: [-side/2, +side/2])
  volume_side_mm: 1.0

  # Default number of ME nanoparticle sensors
  sensor_count: 10000

  # Random seed for reproducibility
  random_seed: 42

  # Singularity threshold: sensors closer than this to a source get clamped
  singularity_threshold_mm: 0.05

  # Nanoparticle radius in nanometers (for future collision detection)
  particle_radius_nm: 100.0

# -----------------------------------------------------------------------------
# Phase 2: Temporal Dynamics Parameters
# -----------------------------------------------------------------------------
temporal:
  # Sampling rate in Hz (1 kHz = Nyquist for ~500 Hz signals)
  sampling_rate_hz: 1000.0

  # Simulation duration in seconds
  duration_sec: 2.0

  # Signal-to-Noise Ratio (linear scale, not dB)
  # SNR=5 means signal power is 5x noise power (~7 dB)
  snr_level: 5.0

# -----------------------------------------------------------------------------
# Phase 3: Source Separation (PCA/ICA) Parameters
# -----------------------------------------------------------------------------
unmixing:
  # PCA variance threshold (0.999 = keep 99.9% of variance)
  pca_variance_threshold: 0.999

  # Number of independent sources to recover
  n_sources: 3

  # FastICA maximum iterations
  ica_max_iter: 1000

  # FastICA random seed
  ica_random_state: 42

# -----------------------------------------------------------------------------
# Phase 4: Real-Time Decoding Parameters
# -----------------------------------------------------------------------------
realtime:
  # Chunk size in milliseconds
  # Trade-off: Smaller = lower latency but less accurate
  #            Larger = more accurate but higher latency
  # 100ms is chosen as a balance (~10 samples of 10Hz alpha wave per chunk)
  chunk_size_ms: 100.0

  # Rolling display window in milliseconds
  window_ms: 500.0

  # Number of sensors to display in real-time dashboard (for performance)
  display_sensors: 50

  # Animation update interval in milliseconds
  animation_interval_ms: 50

# -----------------------------------------------------------------------------
# Phase 5: Hemodynamic / Biological Parameters
# -----------------------------------------------------------------------------
biology:
  # Master toggle for cardiac-correlated artifacts
  # When true, sensor positions oscillate with cardiac rhythm
  cardiac_pulse_active: true

  # Toggle for vascular distribution mode (vs uniform cloud)
  # When true, sensors distribute along vessel tree rather than uniform cube
  vascular_distribution: false

  # Hemodynamic drift parameters (sensor position oscillation)
  hemodynamic:
    # Amplitude of cardiac-induced sensor displacement in mm
    # Typical capillary pulsatility is ~50 microns
    drift_amplitude_mm: 0.05

    # Cardiac frequency in Hz (~72 BPM = 1.2 Hz at rest)
    drift_frequency_hz: 1.2

    # Phase coherence within vessels (0=random, 1=fully synchronized)
    phase_coherence: 0.2

  # Artifact rejection parameters for online decoder pre-processing
  artifact_rejection:
    # Toggle for runtime artifact rejection in decode()
    enabled: false

    # Adaptive filter method: "rls" (Recursive Least Squares) or "lms" (Least Mean Squares)
    method: "rls"

    # Number of filter taps (higher = more complex artifact models)
    n_taps: 32

    # RLS forgetting factor (0.99 = slow adaptation, 0.9 = fast adaptation)
    lambda_: 0.99

    # LMS step size (only used if method="lms")
    mu: 0.01

# -----------------------------------------------------------------------------
# Phase 5: Cardiac Physics - Heartbeat Stress Test Parameters
# -----------------------------------------------------------------------------
cardiac_physics:
  # Master toggle for realistic cardiac waveform (vs simple sine)
  use_realistic_waveform: true

  # Cardiac waveform shape parameters (fraction of cycle)
  systole_fraction: 0.30       # Rapid systolic contraction (30% of cycle)
  dicrotic_position: 0.60      # Dicrotic notch at 60% of cycle
  dicrotic_amplitude: 0.15     # Notch amplitude as fraction of peak

  # Pulse wave propagation parameters
  propagation_velocity_m_s: 7.5  # Arterial pulse wave velocity
  cardiac_origin: [0.0, 0.0, 0.5]  # Origin point for phase propagation (mm)

# -----------------------------------------------------------------------------
# Phase 5: Artifact Model Parameters
# -----------------------------------------------------------------------------
artifact_model:
  # Use full gradient model: A(t) = ∇L · δr(t)
  # When false, uses simpler scalar lead field model
  use_gradient_model: true

  # Artifact amplitude scaling factor
  artifact_scale: 1.0

  # Minimum distance for gradient computation (singularity avoidance)
  min_distance_mm: 0.05

# -----------------------------------------------------------------------------
# Phase 5: Stress Test Parameters
# -----------------------------------------------------------------------------
stress_test:
  # Real-time latency budget in ms
  # Processing must complete within this window for BCI control
  latency_budget_ms: 43

  # Chunk size for streaming simulation
  chunk_size_ms: 100

  # Minimum artifact rejection requirement (dB)
  min_rejection_db: 10

  # Number of sensors for stress test
  n_sensors: 10000

  # Simulation duration for stress test (seconds)
  duration_sec: 1.0

# -----------------------------------------------------------------------------
# Physics Constants (generally should not be modified)
# -----------------------------------------------------------------------------
physics:
  # Brain tissue conductivity in S/m (Gabriel et al., 1996)
  brain_conductivity_s_m: 0.33

  # Source waveform frequencies in Hz
  source_frequencies_hz:
    alpha: 10.0
    beta: 20.0
